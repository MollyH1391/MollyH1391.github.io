@model WowDin.Frontstage.Models.ViewModel.Order.CartDetailViewModel

@section topJS{
    <script src="~/js/Order/Shopinfo.js"></script>
}

@{
    var isGroupBuy = Model.IsGroupBuy;
}

<script>
    let city = '@Html.Raw(Model.StoreCity)'
    let district = '@Html.Raw(Model.StoreDistrict)'
    let shopOpenTime = '@Html.Raw(Model.OpenTime)'
    let shopCloseTime = '@Html.Raw(Model.CloseTime)'
</script>

<div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-8 col-sm-8 col-lg-8">
                                    <div class="row">
                                        <div class="col-12 mt-2 ">
                                            <h3 class="cart_detail_brandTxt fw-bold text_blue">@Model.CartShopData.Brand @Model.CartShopData.ShopName</h3>
                                        </div>
                                        <div class="col-12 mt-3">
                                            <h3 class="">@Model.CartShopData.ShopPhone</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 col-sm-4 col-lg-4 d-flex align-items-center">
                                    <button id="menu_group_btn" type="button" data-bs-toggle="modal" data-bs-target="#menu_group_modal"
                                        class="btn bg_blue cart_groupbuy_button p-0 rounded-3 ms-auto">
                                        <img class="" src="../../img/Cart/揪團按紐.svg" alt="揪團按紐">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--揪團 modal -->
            <!--揪團 modal -->
           <div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-12">
                                    <h4 class="fz_16 fw-bolder">Cart Details</h4>
                                </div>
                            </div>
                            
                            <div id="updateCartProducts">
                                @await Html.PartialAsync("_Update_CartProducts")
                            </div>
  
                                <div class="row mt-2">
                                    <div class="col-3 m-auto">
                                        <button id="reloadcartBtn" type="button" class=" btn btn-outline-secondary w-100 d-flex justify-content-evenly">
                                            <p class="mb-0 d-inline-block"><i class="fas fa-redo-alt text_gray"></i></p>
                                            <p class="mb-0 d-inline-block">cart details update</p>
                                        </button>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-12 ">
                                    <h4 class="fz_16 fw-bolder">取餐方式</h4>
                                    <p class=" my-1 required d-none">請選擇取餐方式</p>
                                </div>
                                <div id="selftakeNoShow" class="col-12 my-2">
                                    <div class="d-flex form-check">
                                        <input value="自取" class="my-auto form-check-input" type="radio" name="flexRadioDefault-take"
                                            id="flexRadioDefault_take" checked>
                                        <label class="ms-1 form-check-label" for="flexRadioDefault-take">
                                            @Model.TakeMethod 
                                        </label>
                                    </div>
                                </div>
                                <div id="take_map" class="col-12 my-2 position-relative">
                                    <h6 class="cart_details_inputTxt">請確認取貨門市位置，點選地圖查看</h6>
                                    <a target="_blank" href="https://www.google.com/maps/place/@Model.StoreAddress">
                                        <div class="input-group my-2">
                                            <input type="button" readonly id="showgooglemap" value = @Model.StoreAddress
                                                class="text-start form-control cart_details_mapInput input_noshadow py-3"
                                                aria-label="">
                                                <div class="input-group-text cart_details_map">
                                                    <i class="fas fa-map-marker-alt fz_18 text_blue"></i>
                                                </div>
                                        </div>
                                    </a>
                                </div>
                                    <div id="deliveryNoShow" class="col-12 my-2">
                                        <div class="d-flex form-check">
                                            <input value="外送" id="flexRadioDefault-delivery" class="my-auto form-check-input" type="radio" name="flexRadioDefault-take" >
                                            <label class="ms-1 form-check-label" for="flexRadioDefault-delivery" data-bs-toggle="modal" data-bs-target="#searchzone_finddistrict_modal">
                                                外送 
                                                <span class="d-inline-block my-1 addressrequired d-none">請填寫詳細地址</span>
                                            </label>
                                            
                                        </div>
                                    </div>
                                    <div id="delivery_address" class="col-12 my-2 position-relative form-check-label" >
                                        <h6 class="cart_details_inputTxt">請輸入地址</h6>
                                            <div class="input-group my-2">
                                                <input type="button" readonly id="showDeliveryAddress"
                                                    class="text-start form-control input_noshadow py-3"
                                                    aria-label="">
                                            </div>
                                    </div>
                                <!-- Address modal OK-->
                                <div class="modal fade" id="searchzone_finddistrict_modal" tabindex="-1" aria-labelledby="finddistrictModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content">
                                            <div class="modal-header mx-3">
                                                <h5 class="modal-titles fw-bold mx-auto mt-2 fz_17" id="finddistrictModalLabel">找區域</h5>
                                                <button type="button" data-bs-dismiss="modal" aria-label="Close"><i
                                                        class="fas fa-times-circle text_pink fz_18"></i></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row justify-content-evenly">
                                                   @* <p class="text-center mb-4 text_score">只輸入縣市即可搜尋門市，<br>輸入其他條件，搜尋更精確!</p>*@
                                                    <p class="mb-2 icon_category ms-4"><span class="text_pink">＊</span>縣市區域</p>
                                                    <div class="col-5 ps-0 me-3">
                                                        <select class="searchzone_finddistrict_select form-select me-1 city_select"></select>
                                                    </div>
                                                    <div class="col-5 ps-0 me-2">
                                                        <select class="searchzone_finddistrict_select form-select district_select"></select>
                                                    </div>
                                                    <div class="searchzone_finddistrict_input d-flex flex-column mt-4 px-4">
                                                        <p class="mb-2 icon_category">地址</p>
                                                        <input id="addressInput" class="address" type="text" placeholder="請輸入路名，如信義路">
                                                    </div>
                                                    <div class="searchzone_finddistrict_input d-flex flex-column mt-4 px-4">
                                                        <p class="mb-2 icon_category">地址備註</p>
                                                        <input id ="addressnote" class="addressnote" type="text" placeholder="公司 /地標 /樓層">
                                                    </div>
                                                    
                                                    <button id="checkAddress" data-bs-dismiss="modal" aria-label="Close" class="searchzone_finddistrict_btn px-3 mt-4 bg_pink text_white fz_18">確定</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              <!-- Address modal -->
                                <div class="col-12 my-2">
                                    <h4 class="fz_16 fw-bolder">預計取餐時間</h4>
                                    <p class=" my-1 timerequired d-none">請選擇取餐時間</p>
                                </div>
                                <div class="col-12 my-2 position-relative">
                                    <button class="w-100" type="button" data-bs-toggle="modal"
                                        data-bs-target="#order_time_modal">
                                        <h6 class="cart_details_inputTxt">請選擇日期</h6>
                                        <div class="input-group my-2">
                                            <input name="time" type="text" id="showPickUpDate" value="" readonly data-bs-toggle="modal" data-bs-target="#calendarModal"
                                                class="form-control input_noshadow py-3 bg_white">
                                        </div>
                                    </button>
                                </div>
                                <div  class="col-12 my-2 position-relative">
                                    <button  class="w-100" type="button" data-bs-toggle="modal" data-bs-target="#timepickermodal">
                                        <h6 class="cart_details_inputTxt">請選擇預計取餐時間，取餐時間會依門市現場狀況調整</h6>
                                            <div class="input-group my-2">
                                                <input name="time" type="text" id="showPickUpTime" value="" readonly
                                                    class="form-control input_noshadow py-3 bg_white time-pickable">
                                            </div>
                                    </button>
                                </div>
                                <!--timepickup Modal -->
                                <div class="modal fade" id="timepickermodal" tabindex="-1" aria-labelledby="finddistrictModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <div class="row justify-content-evenly">

                                                    <div id="timeSelect" class="col-6 d-flex justify-content-center">
                                                        
                                                    </div>
                                                    <div id="minSelect" class="col-6 d-flex justify-content-center">
                                                        
                                                    </div>
                                                    <p class="mb-0 mt-1 text_pink fw-bold">營業時間: @Model.OpenTime ~ @Model.CloseTime
                                                    <button id="checkTimePickUp" class="btn bg_blue text_white fw-bold w-100" data-bs-dismiss="modal">確定</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--timepickup Modal -->
                                <div class="col-12 my-2 position-relative">
                                    <div class="bg_lightpink p-2 rounded-3 my-2 d-flex">
                                        <p class="d-inline-block mb-0">
                                            <i class="d-inline-block fas fa-exclamation-circle text_pink me-2 "></i>
                                            預計取餐時間會依門市狀況調整，請在送單後再次確認，並保持電話暢通避免溝通延誤
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!--calendar Modal -->
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div id="showCalendar" class="">
                                <div class="row justify-content-center">
                                    <div class="col-12">
                                        <h3 class="text-center fz_18"> <span id="Year" class="fz_18"></span>年 - <span id="Month" class="fz_18"></span>月</h3>
                                        <div class="d-block d-flex justify-content-between">
                                            <button type="button" class="btn btn-outline-secondary" onclick="previousMonth()">往上月</button>
                                            <button type="button" class="btn btn-outline-secondary" onclick="nextMonth()">往下月</button>
                                        </div>
                                        <table class="table text-center">
                                            <thead>
                                                <tr>
                                                    <th>日</th>
                                                    <th>一</th>
                                                    <th>二</th>
                                                    <th>三</th>
                                                    <th>四</th>
                                                    <th>五</th>
                                                    <th>六</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 動態生成日期 -->
            
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 <!--calendar Modal -->
           
            <!--takeMethod modal -->
            
            <div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-12 ">
                                    <h4 class="fz_16 fw-bolder">折扣優惠</h4>
                                </div>
                                <!-- <div class="col-12 my-2">
                                    <div class="form-check d-flex">
                                        <input class="form-check-input my-auto" type="checkbox" value=""
                                            id="flexRadioDefault-discount">
                                        <label class="form-check-label ms-2" for="flexRadioDefault-discount">
                                            折價券
                                        </label>
                                    </div>
                                </div> -->
                                <div class="col-12">
                                    <div class="row g-3">
                                        <div class="col">
                                            @if(Model.UsableCoupons.Count() == 0)
                                            {
                                                <select id="coupon_selector" class="form-select w-100">
                                                    <option value="0">-- 無可使用的優惠 --</option>
                                                    
                                                </select>
                                                @*<input id="coupon_selector" type="text" class="form-control input_noshadow py-3" placeholder="無可用折價券" aria-label="" disabled>*@
                                            }
                                            else
                                            {
                                                <select id="coupon_selector" class="form-select w-100">
                                                    <option value="0">-- 不使用優惠 --</option>
                                                    @foreach(var coupon in Model.UsableCoupons){
                                                        <option value="@coupon.CouponId">@coupon.CouponTitle</option>
                                                    }
                                                </select>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-4 py-2">
                                    <h4 class="fz_16 fw-bolder d-inline-block">活動</h4>
                                </div>
                                <div class="col-8 d-flex justify-content-end">
                                    <h6 class="d-inline-block text_disable_checkbox py-2">單筆訂單僅會參與一檔活動</h6>
                                </div>
                                <div class="col-12 my-2">
                                    <div class="accordion accordion-flush" id="accordion">
                                        <div class="accordion-item ">
                                            <h2 class="accordion-header" id="flush-headingOne">
                                                <button
                                                    class="accordion-button collapsed cart_details_activity rounded-3"
                                                    type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#flush-collapseOne" aria-expanded="false"
                                                    aria-controls="flush-collapseOne">
                                                    <span
                                                        class="badge bg_state_success d-inline-block px-3 me-3">參加</span>
                                                    <p class="my-0 d-inline-block">茶詠春開幕慶，自取滿150元享88折優惠</p>
                                                </button>
                                            </h2>
                                            <div id="flush-collapseOne" class="accordion-collapse collapse"
                                                aria-labelledby="flush-headingOne" data-bs-parent="#accordion">
                                                <div class="accordion-body">3/1~3/18 茶詠春開幕慶，自取滿150元享88折優惠。
                                                    茶詠春擁有做最後說明調整的權利。你訂線上訂餐專屬優惠，此優惠不與其他優惠折扣併用。
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 my-2">
                                    <div class="accordion accordion-flush" id="accordionFlushExample">
                                        <div class="accordion-item ">
                                            <h2 class="accordion-header" id="flush-headingTwo">
                                                <button
                                                    class="accordion-button collapsed cart_details_activity rounded-3"
                                                    type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#flush-collapseTwo" aria-expanded="false"
                                                    aria-controls="flush-collapseTwo">
                                                    <span class="badge bg_pink d-inline-block px-3 me-3 ">參加</span>
                                                    <p class="my-0 d-inline-block">茶詠春開幕慶</p>
                                                </button>
                                            </h2>
                                            <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                                aria-labelledby="flush-headingTwo"
                                                data-bs-parent="#accordionFlushExample">
                                                <div class="accordion-body">3/1~3/18 茶詠春開幕慶，自取滿150元享88折優惠。
                                                    茶詠春擁有做最後說明調整的權利。你訂線上訂餐專屬優惠，此優惠不與其他優惠折扣併用。
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>*@
            @*<div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body">
                            <div class="row py-2 px-3">
                                <div class="col-12 ">
                                    <h4 class="fz_16 fw-bolder">塑膠袋</h4>
                                </div>
                                <div class="col-12 d-flex justify-content-between align-items-center">
                                    <h5 class="d-inline-block fz_15 py-2">是否需要塑膠袋</h5>
                                    <div class="form-check form-switch d-inline-block">
                                        <input class="form-check-input fz_16 input_noshadow cart_details_checkbox"
                                            type="checkbox" role="switch" id="flexSwitchCheckDefault">
                                        <label class="form-check-label" for="flexSwitchCheckDefault"></label>
                                    </div>
                                </div>
                                <div class="col-12 ">
                                    <h5 class="text_gray">
                                        依據政策規定，即日起需自行購買塑膠袋並支付相關費用，份數較多的訂單請斟酌加購
                                    </h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>*@
            <div class="row justify-content-center mb-2">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="card rounded-1">
                        <div class="card-body pb-0">
                            <div class="row py-2 px-3">
                                <div class="col-12  ">
                                    <h4 class="fz_16 fw-bolder cart_details_border pb-3">訂單匯總</h4>
                                </div>
                                <div class="col-12 my-2 d-flex justify-content-between">
                                    <p class="d-inline-block">商品 x <span id="summary_amount">@Model.TotalQuantity</span></p>
                                    <p class="d-inline-block">$ <span id="summary_price">@Model.TotalPrice</span></p>
                                </div>
                                <div class="col-12 mb-2 d-flex justify-content-between cart_details_border">
                                    <p class="d-inline-block">活動折扣</p>
                                    <p class="d-inline-block text_pink">-$ 
                                        <span id="discount_dollar">
                                            0
                                        </span>
                                    </p>
                                </div>
                                <div id="showCartDeliveryFee" class="d-none col-12 mb-2 d-flex justify-content-between cart_details_border">
                                    <p class="d-inline-block">外送費</p>
                                    <p class="d-inline-block text_pink">+$
                                        <span id="deliveryFee_dollar">
                                            0
                                        </span>
                                    </p>
                                </div>
                                <div class="col-12 mt-2 d-flex justify-content-between">
                                    <p class="d-inline-block text_pink fw-bold">應付金額</p>
                                    <p class="d-inline-block text_pink fw-bold">
                                        $
                                        <span id="summary_final_price">@Model.TotalPrice</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-12 col-sm-10 col-lg-8">
                    <div class="row">
                        <a href="/Store/ShopMenu/@Model.ShopId" class="col-6 pe-0">
                            <button type="button"
                                class="w-100 bg_white rounded-2 py-3 fw-bold input_noshadow">繼續加購</button>
                        </a>
                        <div  class="col-6 ps-0">
                            <button id="partialControlBtn" type="button"
                            class=" w-100 bg_pink rounded-2 py-3 text_white fw-bold cart_details_nextBtn input_noshadow">
                                下一步
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*外送modal*@

        <div class="modal fade" id="warnDeliveryFee" tabindex="-1" aria-labelledby="finddistrictModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-12">
                               <p id="showWainingMsg" class="text-center text_pink fw-bold"></p>
                            </div>
                            <div class="col-6">
                                <a class="btn bg_blue text_white fw-bold w-100" href="/Store/ShopMenu/@Model.ShopId">繼續加購</a>
                            </div>
                            <div class="col-6">
                                <button id="warnDeliveryFee" class="btn bg_page fw-bold w-100" data-bs-dismiss="modal">關閉</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                
